# 一个LoRaWAN网关能支持多少个节点

    对于需要购买LoRaWAN网关的人来说，可能最重要的一个问题就是：
    一个网关能容纳多少个节点？我有N个节点，需要配备多少个LoRaWAN网关才够用？
    很可惜的是，这个问题没有简单的答案

## LoRaWAN网关单网关能容纳的节点的数量

### 理论值

    假设单个网关每天最多可以接收a个数据包，每个节点的应用发包频率是每小时b个数据包的话，
    那么，单个网关最多可以容纳的节点的数目的理论值的计算式如下：
    S = a / (24 * b)

    比如，单个LoRaWAN网关如果搭载一个SX1301芯片的话，其每天最多可以接收150万个数据包，
    如果应用发包频率是每小时1包的话，
    那么理论上该LoRaWAN网关可以接入的节点的数目 S = 1500000 / (24 * 1) = 62500个

### 实际值

    单个网关可以容纳节点的数目的实际值比理论值的计算要复杂的多。
    对于确定的某个网关来说，其每天最多可以接收的数据包也是确定的，
    难就难在每个节点到底每天发多少个包。

    在同一个应用场景下，我们每天需要该节点发送的总的数据长度是确定的，
    但是，确定长度的数据到底要以怎样的封包长度、发送速率来发送，就不确定了。
    封包长度如果不同，势必需要发送的包的数量也就不同。

    比如，在不同的信号强度下，所用到的扩频因子SF也不同，
    那么，能发送的数据的长度也就不同，
    每次能发送的数据的长度不同就会导致需要分成的包的数量也不相同，
    从而导致即使使用同样的网关、同样的节点，但在节点的不同业务模式下，
    也会出现单个网关容纳节点的最大数目并不相同的情况。

    对于有8个信道的网关来说，在没有LBT(发包前监听信道)和上行包不需要下行确认包的前提下，
    具体的计算公式为:
    信道容量（即节点数量）S = (8 * T) / (2e * t0)

    其中，8代表8个信道，T代表发送间隔，跟封包长度、速率有关系，
    1/2e 是基本Aloha算法最大吞吐量，e是常数，等于2.718，t0代表单包的ToA（Time on Air）。

    举一个例子，假如使用SX1301芯片，在没有LBT(发包前监听信道)和上行包不需要下行确认包的情况下，
    并且平均每个包空中飞行时间t0=100ms（因此t0=0.1s），平均每个包一分钟发一次（因此T=60s），
    那么可以容纳多少这样的平均节点呢？S = (8 * 60) / (2 * 2.718 * 0.1) = 883，
    因此，可以容纳883个节点。

    采用不同算法，也会导致最大吞吐量的变化，从而引起理论容量的变化。
    比如，如果前提条件修改成每个节点都带有LBT功能，
    采用时隙Aloha算法而不是之前的基本Aloha算法来评估，则由于算法不同，
    导致最大吞吐量不同，此时最大吞吐量是1/e，因此信道容量（即节点数量）S = (8 * T) / (e * t0)，
    从而 ，则理论容量增加一倍，即883 * 2 = 1766个节点。
